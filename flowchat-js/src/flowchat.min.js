(function($){$.fn.flowchat=function(options){var settings=$.extend({delay:1500,startButtonId:'#startButton',autoStart:!0,startMessageId:1,data:null},options);var container=$(this)
$(function(){if(settings.autoStart)
startChat(container,settings.data,settings.startMessageId,settings.delay)});$(document).on('click','.options li',function(){$(this).parent().hide();userReply='<li class="user"><div class="text">'+$(this).html()+'</div></li>';container.children('.chat-window').append(userReply);messages=settings.data;nextMessageId=$(this).attr('data-nextId');nextMessage=findMessageInJsonById(messages,nextMessageId);generateMessageHTML(messages,nextMessage,settings.delay)});$(document).on('click',settings.startButtonId,function(){startChat(container,settings.data,settings.startMessageId,settings.delay)})}
function startChat(container,data,startId,delay){container.html("");container.append("<ul class='chat-window'></ul>");message=findMessageInJsonById(data,startId);generateMessageHTML(data,message,delay)}
function findMessageInJsonById(data,id){var messages=data;for(i=0;messages.length>i;i ++)
if(messages[i].id==id)
return messages[i]}
function addOptions(m){template='<li class="options"><ul>'
for(i=1;i<6;i++){optionText=m["option"+i]
optionMessageId=m["option"+i+"_nextMessageId"]
if(optionText!="")
template=template+"<li data-nextId="+optionMessageId+">"+optionText+"</li>"}
template=template+'</ul></li>';return template}
function toggleLoader(status){if(status=="show")
$('.chat-window').append("<li class='typing-indicator'><span></span><span></span><span></span></li>");else $('.typing-indicator').remove()}
function generateMessageHTML(messages,m,delay){template='<li class="bot"><div class="text">'+m.text+'</div></li>';if(m.messageType=="Question")
template=template+addOptions(m);toggleLoader("show");$(".chat-window").scrollTop($(".chat-window").prop('scrollHeight'));setTimeout(function(){toggleLoader("hide");$('.chat-window').append(template);$(".chat-window").scrollTop($(".chat-window").prop('scrollHeight'));if(m.nextMessageId!=""){console.log(m.nextMessageId);nextMessage=findMessageInJsonById(messages,m.nextMessageId)
generateMessageHTML(messages,nextMessage,delay)}},delay)}}(jQuery))